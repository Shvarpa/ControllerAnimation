<script context="module">
	import ds4ImageConfig from "../resources/ds4ImageConfig";
	import { restore } from "./contexManager";
	// import ds4_svg from "../resources/ds4_svg";
	export const ds4Svg =
		"data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjMDAwMDAwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMTggMTAwIDY0IiB4PSIwcHgiIHk9IjBweCIgaGVpZ2h0PSIxNTAiIHdpZHRoPSIyMzQiPg0KPGRlZnM+PHN0eWxlPi5jbHMtMXtmaWxsOm5vbmU7fTwvc3R5bGU+PC9kZWZzPg0KPHRpdGxlPkRTNDwvdGl0bGU+DQo8Zz4NCjxyZWN0IGNsYXNzPSJjbHMtMSIgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiPjwvcmVjdD4NCjxwYXRoIGQ9Ik0xOS40OSwzNy4wNmEuNzguNzgsMCwwLDEtLjU1LS4yM0wxNi40LDM0LjI5bDAtLjM1VjMwYS43OC43OCwwLDAsMSwuNzgtLjc4aDQuNjdhLjc4Ljc4LDAsMCwxLC43OC43OHY0LjI2bC0uMjQuMjZMMjAsMzYuODNBLjc4Ljc4LDAsMCwxLDE5LjQ5LDM3LjA2Wm0tMS43MS0zLjM3LDEuNzEsMS43MSwxLjcxLTEuNzFWMzAuNkgxNy43OFoiPjwvcGF0aD4NCjxwYXRoIGQ9Ik0yMS44Miw0Ni42OUgxNy4xNWEuNzguNzgsMCwwLDEtLjc4LS43OFY0MS42NGwuMjQtLjI2LDIuMzMtMi4zM2EuNzguNzgsMCwwLDEsMS4xLDBsMi41NCwyLjU0LDAsLjM1djRBLjc4Ljc4LDAsMCwxLDIxLjgyLDQ2LjY5Wm0tNC0xLjRIMjEuMlY0Mi4ybC0xLjcxLTEuNzFMMTcuNzgsNDIuMloiPjwvcGF0aD4NCjxwYXRoIGQ9Ik0yNy40NSw0MS4wNkgyMy4ybC0uMjYtLjIyTDIwLjYsMzguNDlhLjc4Ljc4LDAsMCwxLDAtMS4xbDIuNTQtMi41NC4zNSwwaDRhLjc4Ljc4LDAsMCwxLC43OC43OHY0LjY3QS43OC43OCwwLDAsMSwyNy40NSw0MS4wNlptLTMuNzEtMS40aDMuMDlWMzYuMjNIMjMuNzRMMjIsMzcuOTRaIj48L3BhdGg+DQo8cGF0aCBkPSJNMTUuNDksNDEuMDZoLTRhLjc4Ljc4LDAsMCwxLS43OC0uNzhWMzUuNjFhLjc4Ljc4LDAsMCwxLC43OC0uNzhoNC4yNmwuMjYuMjQsMi4zMywyLjMzYS43OC43OCwwLDAsMSwwLDEuMUwxNS44NCw0MVptLTMuMzUtMS40aDMuMDlMMTcsMzcuOTRsLTEuNzEtMS43MUgxMi4xNVoiPjwvcGF0aD4NCjxwYXRoIGQ9Ik0xOS40OSw0OS41NUExMS44OSwxMS44OSwwLDEsMSwzMS4zOCwzNy42NiwxMS45LDExLjksMCwwLDEsMTkuNDksNDkuNTVabTAtMjIuMzhBMTAuNDksMTAuNDksMCwxLDAsMzAsMzcuNjYsMTAuNSwxMC41LDAsMCwwLDE5LjQ5LDI3LjE3WiI+PC9wYXRoPg0KPCEtLSA8cGF0aCBkPSJNMzMuOTIsNDcuMjFhNC4xOSw0LjE5LDAsMSwxLTQuMTksNC4xOSw0LjIsNC4yLDAsMCwxLDQuMTktNC4xOW0wLTEuNGE1LjU5LDUuNTksMCwxLDAsNS41OSw1LjU5LDUuNTksNS41OSwwLDAsMC01LjU5LTUuNTlaIj48L3BhdGg+IC0tPg0KPHBhdGggZD0iTTMzLjkyLDQzLjc4QTcuNjIsNy42MiwwLDEsMSwyNi4zLDUxLjRhNy42Myw3LjYzLDAsMCwxLDcuNjItNy42Mm0wLTEuNGE5LDksMCwxLDAsOSw5LDksOSwwLDAsMC05LTlaIj48L3BhdGg+DQo8cGF0aCBkPSJNODAuNTEsNDkuNTVBMTEuODksMTEuODksMCwxLDEsOTIuNCwzNy42NiwxMS45LDExLjksMCwwLDEsODAuNTEsNDkuNTVabTAtMjIuMzhBMTAuNDksMTAuNDksMCwxLDAsOTEsMzcuNjYsMTAuNSwxMC41LDAsMCwwLDgwLjUxLDI3LjE3WiI+PC9wYXRoPg0KU2hhcmU6PHBhdGggZD0iTTMwLjEsMjguODhhLjcuNywwLDAsMS0uNy0uN3YtMS43YS43LjcsMCwwLDEsMS40LDB2MS43QS43LjcsMCwwLDEsMzAuMSwyOC44OFoiPjwvcGF0aD4NCk9wdGlvbnM6PHBhdGggZD0iTTY5LjMyLDI4Ljg4YS43LjcsMCwwLDEtLjctLjd2LTEuN2EuNy43LDAsMCwxLDEuNCwwdjEuN0EuNy43LDAsMCwxLDY5LjMyLDI4Ljg4WiI+PC9wYXRoPg0KU3F1YXJlOjxwYXRoIGQ9Ik03NC4wNywzNS44NmExLjgsMS44LDAsMSwxLTEuOCwxLjgsMS44LDEuOCwwLDAsMSwxLjgtMS44bTAtMS40YTMuMiwzLjIsMCwxLDAsMy4yLDMuMiwzLjIsMy4yLDAsMCwwLTMuMi0zLjJaIj48L3BhdGg+DQpDaXJjbGU6PHBhdGggZD0iTTg2LjksMzUuODZhMS44LDEuOCwwLDEsMS0xLjgsMS44LDEuOCwxLjgsMCwwLDEsMS44LTEuOG0wLTEuNGEzLjIsMy4yLDAsMSwwLDMuMiwzLjIsMy4yLDMuMiwwLDAsMC0zLjItMy4yWiI+PC9wYXRoPg0KVHJpYW5nbGU6PHBhdGggZD0iTTgwLjQ5LDI5LjQ0YTEuOCwxLjgsMCwxLDEtMS44LDEuOCwxLjgsMS44LDAsMCwxLDEuOC0xLjhtMC0xLjRhMy4yLDMuMiwwLDEsMCwzLjIsMy4yLDMuMiwzLjIsMCwwLDAtMy4yLTMuMloiPjwvcGF0aD4NCkNyb3NzOjxwYXRoIGQ9Ik04MC40OSw0Mi4yOGExLjgsMS44LDAsMSwxLTEuOCwxLjgsMS44LDEuOCwwLDAsMSwxLjgtMS44bTAtMS40YTMuMiwzLjIsMCwxLDAsMy4yLDMuMiwzLjIsMy4yLDAsMCwwLTMuMi0zLjJaIj48L3BhdGg+DQo8cGF0aCBkPSJNNTAsNTUuMTdhMy4xLDMuMSwwLDEsMSwzLjEtMy4xQTMuMSwzLjEsMCwwLDEsNTAsNTUuMTdabTAtNC43OWExLjcsMS43LDAsMSwwLDEuNywxLjdBMS43LDEuNywwLDAsMCw1MCw1MC4zN1oiPjwvcGF0aD4NCjwhLS0gPHBhdGggZD0iTTY2LjA4LDQ3LjIxYTQuMTksNC4xOSwwLDEsMS00LjE5LDQuMTksNC4yLDQuMiwwLDAsMSw0LjE5LTQuMTltMC0xLjRhNS41OSw1LjU5LDAsMSwwLDUuNTksNS41OSw1LjU5LDUuNTksMCwwLDAtNS41OS01LjU5WiI+PC9wYXRoPiAtLT4NCjxwYXRoIGQ9Ik02Ni4wOCw0My43OGE3LjYyLDcuNjIsMCwxLDEtNy42Miw3LjYyLDcuNjMsNy42MywwLDAsMSw3LjYyLTcuNjJtMC0xLjRhOSw5LDAsMSwwLDksOSw5LDksMCwwLDAtOS05WiI+PC9wYXRoPg0KPHBhdGggZD0iTTg5LjQzLDgxLjM4aC0uMTFjLTUuNDQtLjA3LTguMTItNS4xMS0xMC4yNy05LjE1bC0uMjQtLjQ0QTE1Ny43MiwxNTcuNzIsMCwwLDEsNzIuMSw1Ni44NmEuNy43LDAsMCwxLDEuMy0uNTEsMTU2LjIzLDE1Ni4yMywwLDAsMCw2LjY1LDE0Ljc4bC4yNC40NWMyLjA4LDMuOTEsNC40NCw4LjM1LDkuMDUsOC40MSw0LjMyLDAsNy44OC00LDguNzUtNy44NSwxLjEzLTQuOTQtMi41Mi0yNC42NC0zLjg5LTMwLTEtNC0zLjM4LTEzLjI1LTcuNzctMTlINzQuNzhsLTEuNjMsMS4yMS0uMjgsMGgtNi4xVjM4LjcyYTIuMywyLjMsMCwwLDEtMi4zLDIuM2gtMjlhMi4zLDIuMywwLDAsMS0yLjMtMi4zVjI0LjM4SDI2Ljg5bC0uMjMtLjE2LTEuNDQtMS4wN0gxMy41N2MtNC4zOSw1Ljc0LTYuNzYsMTUtNy43NywxOS0xLjM3LDUuMzUtNSwyNS4wNS0zLjg5LDMwQzIuNzgsNzUuOTIsNi4zMyw4MCwxMC41Nyw4MGguMDljNC42MS0uMDYsNy00LjUsOS4wNS04LjQxbC4yNC0uNDVBMTU2LjIzLDE1Ni4yMywwLDAsMCwyNi42LDU2LjM0YS43LjcsMCwwLDEsMS4zLjUxLDE1Ny43MiwxNTcuNzIsMCwwLDEtNi43MiwxNC45MmwtLjI0LjQ0Yy0yLjE1LDQtNC44Myw5LjA4LTEwLjI3LDkuMTVoLS4xMWMtNC45MywwLTktNC42Mi0xMC04Ljk0LTEuMjYtNS41MSwyLjc2LTI2LjE5LDMuOS0zMC42NUM1LjUsMzcuNjYsOCwyOCwxMi42NiwyMi4wNWwuMjEtLjI3LjQsMEgyNS42NmwuMjMuMTZMMjcuMzMsMjNoNi41MWEuNzguNzgsMCwwLDEsLjc4Ljc4djE1YS45LjksMCwwLDAsLjkuOWgyOWEuOS45LDAsMCwwLC45LS45di0xNWEuNzguNzgsMCwwLDEsLjc4LS43OGg2LjUxbDEuNjMtMS4yMS4yOCwwaDEyLjVsLjI3LjMxQzkyLDI4LDk0LjUsMzcuNjYsOTUuNTYsNDEuNzljMS4xNCw0LjQ2LDUuMTYsMjUuMTQsMy45LDMwLjY1Qzk4LjQ3LDc2Ljc2LDk0LjM2LDgxLjM4LDg5LjQzLDgxLjM4WiI+PC9wYXRoPg0KDQo8cGF0aCBkPSJNNjEuMTMsNTguNzYgSDM4LjkgYS43LjcsMCwwLDEsMC0xLjQgSDYxLjEzIGEuNy43LDAsMCwxLDAsMS40IFoiPjwvcGF0aD4NCg0KPHBhdGggZD0iTTY2LDI1LjE4YS43LjcsMCwwLDEtLjYyLS4zN2wtLjcyLTEuMzZIMzUuMzFsLS43MiwxLjM2YS43LjcsMCwwLDEtMS4yNC0uNjZsMS4wOS0yLjA2LjQ5LDBINjUuNDdsLjI3LjQuOSwxLjdhLjcuNywwLDAsMS0uNjIsMVoiPjwvcGF0aD4NCjxwYXRoIGQ9Ik0yNS4wOSwyMS44NWEuNy43LDAsMCwxLS41Ni0uMjdBNCw0LDAsMCwwLDIxLjM5LDIwSDE4YTQsNCwwLDAsMC0zLjE0LDEuNTUuNy43LDAsMSwxLTEuMTEtLjg1QTUuNCw1LjQsMCwwLDEsMTgsMTguNjJoMy40MmE1LjQsNS40LDAsMCwxLDQuMjUsMi4xLjcuNywwLDAsMS0uNTUsMS4xM1oiPjwvcGF0aD4NCjxwYXRoIGQ9Ik04NiwyMS44NWEuNy43LDAsMCwxLS41Ni0uMjdBNCw0LDAsMCwwLDgyLjM0LDIwSDc4LjkxYTQsNCwwLDAsMC0zLjE0LDEuNTUuNy43LDAsMSwxLTEuMTEtLjg1LDUuNCw1LjQsMCwwLDEsNC4yNS0yLjFoMy40MmE1LjQsNS40LDAsMCwxLDQuMjUsMi4xQS43LjcsMCwwLDEsODYsMjEuODVaIj48L3BhdGg+DQpTcGVha2VyIERvdHM6DQo8Y2lyY2xlIGN4PSI1MCIgY3k9IjQ3LjI3IiByPSIwLjgiPjwvY2lyY2xlPg0KPGNpcmNsZSBjeD0iNDcuNiIgY3k9IjQ3LjI3IiByPSIwLjgiPjwvY2lyY2xlPg0KPGNpcmNsZSBjeD0iNTIuNCIgY3k9IjQ3LjI3IiByPSIwLjgiPjwvY2lyY2xlPg0KPGNpcmNsZSBjeD0iNTAiIGN5PSI0My4yOCIgcj0iMC44Ij48L2NpcmNsZT4NCjxjaXJjbGUgY3g9IjQ3LjYiIGN5PSI0My4yOCIgcj0iMC44Ij48L2NpcmNsZT4NCjxjaXJjbGUgY3g9IjUyLjQiIGN5PSI0My4yOCIgcj0iMC44Ij48L2NpcmNsZT4NCjxjaXJjbGUgY3g9IjU0LjgiIGN5PSI0My4yOCIgcj0iMC44Ij48L2NpcmNsZT4NCjxjaXJjbGUgY3g9IjQ1LjIiIGN5PSI0My4yOCIgcj0iMC44Ij48L2NpcmNsZT4NCjxjaXJjbGUgY3g9IjUxLjIiIGN5PSI0NS4yNyIgcj0iMC44Ij48L2NpcmNsZT4NCjxjaXJjbGUgY3g9IjQ4LjgiIGN5PSI0NS4yNyIgcj0iMC44Ij48L2NpcmNsZT4NCjxjaXJjbGUgY3g9IjUzLjYiIGN5PSI0NS4yNyIgcj0iMC44Ij48L2NpcmNsZT4NCjxjaXJjbGUgY3g9IjQ2LjQiIGN5PSI0NS4yNyIgcj0iMC44Ij48L2NpcmNsZT4NCjwvZz4NCjwvc3ZnPg==";
</script>

<script>
	import Controller from "./Controller.svelte";
	import { onMount } from "svelte";
	import defaultConfig from "./defaultConfig";

	export let config = undefined;
	export let gamepad = undefined;
	export let size = undefined;
	export let showText = false;
	export let picker = false;
	export let lightbarColor = undefined;
	$: config = config == undefined ? defaultConfig : config;

	const drawLightbar = canvas => {
		if (!lightbarColor) return;
		let { width, height } = canvas;
		let ctx = canvas.getContext("2d");
		restore(ctx, ["strokeStyle", "globalAlpha"])(() => {
			ctx.strokeStyle = lightbarColor;
			ctx.globalAlpha = 1;
			ctx.beginPath();
			ctx.moveTo(0.36 * width, 0.1 * height);
			ctx.lineTo(0.64 * width, 0.1 * height);
			ctx.stroke();
			ctx.closePath();
		});
	};
</script>

<Controller
	{gamepad}
	{size}
	{showText}
	{picker}
	controllerIconSrc="{ds4Svg}"
	imageConfig="{ds4ImageConfig}"
	controllerConfig="{config}"
	detectionScale="{1.5}"
	axisRadiusScale="{0.08}"
	addons="{[drawLightbar]}"
	on:click />
